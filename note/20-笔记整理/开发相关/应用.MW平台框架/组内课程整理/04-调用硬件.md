# 任务目标

使用框架的控件，显示配置的硬件信息

# 操作步骤

## 使用硬件模块

在配置完成后，需要在程序中使用相关硬件

### 1 添加手动控制页面

#### 1.1 添加一个新的窗口 ManualMotionWindowView

这个xaml文件的类型是CommonWindow

```XML
<mw:CommonWindow x:Class="Demo.Footer.View.ManualMotionWindowView"
                 ...
                 xmlns:mw="http://www.maxwell-gp.com/"
                 xmlns:ui="http://www.maxwell.com/controls">
    <Grid>
        <ui:ManualControlView />
    </Grid>
</mw:CommonWindow>
```

#### 1.2 在需要启动的手动控制窗口的ViewModel里添加

```csharp
public class XXXViewModel : IView
{
    private readonly IDeviceList deviceList;
    private readonly List<MwCard> cards;
    private readonly ManualMotionWindowView mmWindow;

    public XXXViewModel(IDeviceManager manager)
    {
        deviceList = manager as IDeviceList;
        cards = deviceList?.GetDevices<MwCard>();
        mmWindow = new ManualMotionWindowView
        {
            DataContext = new ManualControlViewModel(cards),
            Owner = Application.Current.MainWindow
        };
        mmWindow.Closing += MmWindowClosing;
    }

    private void MmWindowClosing(object sender, System.ComponentModel.CancelEventArgs e)
    {
        mmWindow.Hide();
        e.Cancel = true;
    }

    public void ManualMotionClick()
    {
        mmWindow.Show();
    }
}
```

并将ManualMotionClick绑定到一个按钮上，当点击那个按钮时，就可以打开手动控制窗口了

### 2 添加全局硬件类

### 3 添加IO状态页面

#### 3.1 创建IOStateMonitorView.xaml

```XML
<UserControl x:Class="Demo.Devices.View.IOStateMonitorView"
              ...
             d:DataContext="{d:DesignInstance viewModel:IOStateMonitorViewModel}">
    <Grid>
        <ui:IOView IOProp="{Binding IOProp}" ShowEditRegion="False" />
    </Grid>
</UserControl>
```

#### 3.2 创建IOStateMonitorViewModel.cs

```csharp
public class IOStateMonitorViewModel : Screen, IPage
{
    public string Name { get; set; } = "IOStateMonitor";

    private IDIO ioProp;
    public IDIO IOProp
    {
        get => ioProp;
        set
        {
            ioProp = value;
            OnPropertyChanged("IOProp");
        }
    }

    public IOStateMonitorViewModel(IDeviceManager manager)
    {
        var deviceList = manager as IDeviceList;
        IOProp = deviceList?.GetDevices<IDIO>().FirstOrDefault();
    }
}
```

在创建完成后，在Layout.xml中将`IOStateMonitor`绑定到一个页面即可

### 4 添加IO状态维护页面

#### 4.1 创建IOStateMaintenanceViewl.xaml

```XML
<UserControl x:Class="Demo.Devices.View.IOStateMaintenanceView"
              ...
             d:DataContext="{d:DesignInstance viewModel:AxisStateMaintenanceViewModel}">
    <Grid>
        <ContentControl mw:View.Model="{Binding Service}" />
    </Grid>
</UserControl>

```

#### 4.2 创建IOStateMaintenanceViewModel.cs

```csharp
public class IOStateMaintenanceViewModel : IPage
{
    public string Name { get; set; } = "IOStateMaintenance";

    public IOMaintainViewModel Service { get; private set; }

    public IOStateMaintenanceViewModel(IOMaintainViewModel service)
    {
        Service = service;
    }
}
```

在创建完成后，在Layout.xml中将`IOStateMaintenance`绑定到一个页面即可

### 5 添加轴状态维护页面

#### 5.1 创建AxisStateMaintenanceView.xaml

```XML
<UserControl x:Class="Demo.Devices.View.AxisStateMaintenanceView"
              ...
             d:DataContext="{d:DesignInstance viewModel:AxisStateMaintenanceViewModel}">
    <Grid>
        <ContentControl mw:View.Model="{Binding Service}" />
    </Grid>
</UserControl>

```

#### 5.2 创建AxisStateMaintenanceViewModel.cs

```csharp
public class AxisStateMaintenanceViewModel : IPage
{
    public string Name { get; set; } = "AxisStateMaintenance";

    private Func<IDeviceManager> mFunc;
    public AxisStateViewModel Service { get; private set; }

    public AxisStateMaintenanceViewModel(AxisStateViewModel service, Func<IDeviceManager> mFunc)
    {
        this.mFunc = mFunc;
        Service = service;
        Service.CardList = (mFunc?.Invoke() as IDeviceList)?.GetDevices<MwCard>();
    }
}
```

在创建完成后，在Layout.xml中将`AxisStateMaintenance`绑定到一个页面即可

# 细节分析

## 1 这些绑定的服务（ViewModel）都是从什么地方获取的数据

## 2 全局的硬件服务的作用是什么，他在别的地方都怎么调用硬件的