---
title: 巨量转移流程说明
category: 项目整理
tags: 
    - 巨量转移
    - LMT-4A
date: 2023-10-28
---

# 工作问题说明

在巨量转移的过程中，有这样一个需求，上基板与下基板的形状为矩形大小不一致，需要生成晶粒的对应关系来构成晶粒的转移方案，其中上下基板的对应关系会比较复杂。
如图
1. 基板分部情况

![上基板分部情况|300](https://cdn.jsdelivr.net/gh/Ailurus-2233/PicGo-ImageRepo@main/work-Image/202310111433597.png)

2. 下基板分部情况

![image.png|300](https://cdn.jsdelivr.net/gh/Ailurus-2233/PicGo-ImageRepo@main/work-Image/202310111435319.png)

# 问题解决方案

## 上下基板转移区域划分方案

### 方案前提

1. 一个振镜的工作范围，就是一个转移区域的范围。
2. 上下基板的晶粒间隔成整数倍关系
3. 振镜的工作区域是一个正方形区域

### 数据预处理

对于同一种颜色，根据输入的下基板宽度与高度，晶粒相对Mark坐标以及晶粒的横向与竖线间隔计算出此时下基板晶粒的数量分布情况（即水平方向的数量与垂直方向的数量）。

### 下基板分区方案

从数据预处理中获得了下基板三种颜色的数量分布情况，计为$x_r, y_r, x_g, y_g, x_b, y_b$，那么对于宽度为$w$振镜范围，其中的晶粒数量分布是可以根据晶粒间隔计算出来的，计为$x_{lr}, y_{lr}, x_{lg}, y_{lg}, x_{lb}, y_{lb}$，那么一个合理的工作范围，是需要满足以下的条件：

1. $x_r$可以整除$x_{lr}$（记结果为$m_r$）
2. $x_g$可以整除$x_{lg}$（记结果为$m_g$）
3. $x_b$可以整除$x_{lb}$（记结果为$m_b$）
4. $m_r$ = $m_g$ = $m_b$
5. $y_r$可以整除$y_{lr}$（记结果为$n_r$）
6. $y_g$可以整除$y_{lg}$（记结果为$n_g$）
7. $y_b$可以整除$y_{lb}$（记结果为$n_b$）
8. $n_r$ = $n_g$ = $n_b$

由于实际情况中，很难存在刚好整除的情况，所以这里将整除条件替换为

1. $(x_r \mod x_{lr}) / {x_{lr} \ \textgreater \ 0.9 }$ (即无法整除时，剩余的数量能够达到振镜的数量的90%，也认为是可行的，但是这样处理的话，上基板对应区域是会有存余的可能)

#### 确定振镜工作范围

设定振镜的工作范围30-50，遍历这个范围能够满足上述条件的振镜工作范围，推荐给用户选择。

### 上基板分区方案

对于上基板分区希望每个分区刚好能够对应一个下基板分区，这样子一次对位就转移一个完整的分区，基于用户选择的工作范围，将上基板划分成n个区域如下图所示，

由于上下基板晶粒的间隔是成整数倍的，所以对于每个上基板区域，可以转移$k \times j$个下基板区域，如图所示，进一步将一个上基板区域为 $k \times j$ 个区域。

对于一个上基板我们对其编号，如图所示，

而对于输入的上基板大小需要有一个合法性的判断，这时需要分为两种不同的情况来处理

#### 上下基板大小一致

当上下基板大小一致时，以为设定下基板可以不用整除，所以上基板的最后一列或者一行可能无法被一整个区域覆盖，但是仍能够为下基板对应区域提供晶粒，如图所示，

所以只需要满足以下条件即可
1. $k \times x_{down} \leq x_{up}$
2. $j \times y_{down} \leq y_{up}$

其中$x_{down}，y_{down}$是下基板的晶粒数量分布，$x_{up}, y_{up}$是上基板的晶粒数量分布。

#### 上下基板大小不一致

如果上下基板大小不一致，那么不存在对应区域的说法了，上基板的每个区域的要求都的是完整的，所以需要满足以下条件

1. $x_{up}$ 整除 $x_l$
2. $y_{down}$ 整除 $y_l$

但是实际情况可能无法满足整除，所以修改为

1. $(x_{up} \mod x_{l}) / {x_{l} \ \leq \ 0.1 }$
2. $(y_{up} \mod y_{l}) / {y_{l} \ \leq \ 0.1 }$

即多出的部分不超过振镜晶粒数量分布的10%，则认为是可行的，不过多出部分会保留在上基板，不参与转移。

## 区域存储顺序

如图所示，上下基板区域按照这个次顺序存储到一个列表中，

### 原因
出于对于相同大小基板的考虑，需要保证有缺失的区域对硬起来，所以才用一层一层的顺序，而非打印空一个区域后再打印下一个区域。

## 转移过程流程

从上下基板区域列表中，依次取出一个区域进行转移，如图所示。

# 相关整理

## 存在问题

对于相同大小的上下基板，可能无法满足条件
1. $k \times x_{down} \leq x_{up}$
2. $j \times y_{down} \leq y_{up}$

主要原因如图所示，可能在末端的上基板区域丢失列或者行，从而导致转以后的下基板存在问题。